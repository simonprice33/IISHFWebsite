@using IISHF.Core.Controllers
@using MailKit.Search
@model IISHF.Core.Models.ITCEventInformationViewModel

<div class="container container-custom mt-3">

    @{
        if (@Model == null)
        {
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            </div>
                        </div>
        }
        else
        {
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <strong>Event Reference</strong>
                                <p id="sanction">@Model.SanctionNumber</p>
                                <input id="isChampionship" type="hidden" value="@Model.IsChampionship" />

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <strong>Age Group</strong>
                                <p id="ageGroup">@Model.AgeGroup</p>
                                <input id="shortCode" type="hidden" value="@Model.ShortCode" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <strong>Start and End Date</strong>
                                <p class=""><span id="startDate">@Model.EventStartDate.ToString("dd.MM.yyyy")</span> - <span id="endDate">@Model.EventEndDate.ToString("dd.MM.yyyy")</span></p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <strong>Hosting Club</strong>
                                <p>@Model.HostingClub</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <strong>Event Location</strong>
                                <p>@Model.EvenLocation.Replace("\n", ", ").Replace(",,", ", ")</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <strong>Event Country</strong>
                                <p>@Model.HostingCountry</p>
                            </div>
                        </div>
        }
    }
</div>

<script>
    $(document).ready(function () {

        var sanctionNumber = $('#sanction')[0].innerHTML;

        @if (Model != null && Model.Teams != null && Model.SanctionNumber.StartsWith('A'))
        {
            <text>
            
            var selectedTeamName = $("#teamName").val();
            console.log("Selected Team Name : " + selectedTeamName)

            var teams = @Html.Raw(Json.Serialize(Model.Teams));

            var teamNames = teams.map(function(team) { return team; });
            var isTeamNameInList = teamNames.includes(selectedTeamName);

            if (teams.length > 0) {
                var selectHtml = '<select class="form-control" id="teamName">';
                selectHtml += '<option value="">Select a Team</option>';

                $.each(teams, function (index, team) {
                    selectHtml += `<option value="${team}">${team}</option>`;
                });

                selectHtml += '</select>';
                $('#teamName').replaceWith(selectHtml);

                // Bind change event to reset the selection
                $('#eventSelect').on('change', function () {
                    $('#teamName').val('');
                });

            } else {
                var textboxHtml = '<input type="text" class="form-control" placeholder="Team Name" id="teamName" />';
                $('#teamName').replaceWith(textboxHtml);
            }

            $('#teamName').val(selectedTeamName).change();

            if(selectedTeamName !== "" && isTeamNameInList){
        $('#teamName').prop('disabled', true);
    }
            
            </text>
        }
        else if (Model.SanctionNumber.StartsWith('A'))
        {
            <text>
            var textboxHtml = '<input type="text" class="form-control" placeholder="Team Name" id="teamName" />';
            $('#teamName').replaceWith(textboxHtml);
           

            </text>
        }
        else
        {
            <text>
                     var textboxHtml = '<input type="text" class="form-control" placeholder="Team Name" id="teamName" />';
                    $('#teamName').replaceWith(textboxHtml); 
                    $('#teamName').val('')
            </text>
        }

        // Define the position for the new column based on zero-based index; 8th position for 9th column.
        var columnIndex = 8;

        // Check if the "Is Guest" column already exists
        var isGuestColumnExists = $('#data-table thead tr th').eq(columnIndex).text() === 'Is Guest';

        if (sanctionNumber.charAt(0) !== 'A' && !isGuestColumnExists) {
            // Add the "Is Guest" column header if it does not exist and sanction number does not start with 'A'
            $('<th>Is Guest</th>').insertAfter('#data-table thead tr th:nth-child(' + columnIndex + ')');
            // Add checkbox in each row for the new column
            $('#data-table tbody tr').each(function () {
                $('<td>').insertAfter($(this).find('td:nth-child(' + columnIndex + ')')).append($('<input>', { type: 'checkbox' }));
            });
        } else if (sanctionNumber.charAt(0) === 'A' && isGuestColumnExists) {
            // Remove the "Is Guest" column header and its respective data in each row if sanction number starts with 'A'
            $('#data-table thead tr th:nth-child(' + (columnIndex + 1) + ')').remove(); // +1 because nth-child is 1-based
            $('#data-table tbody tr').each(function () {
                $(this).find('td:nth-child(' + (columnIndex + 1) + ')').remove(); // +1 for the same reason
            });
        }

        if (sanctionNumber.charAt(0)) { 
        $("#guest").hide()
        }

    });
</script>
