@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<ContentModels.ITC>
@using ContentModels = Umbraco.Cms.Web.Common.PublishedModels;
@using System.Globalization
@using Umbraco.Cms.Core.Security
@inject IMemberManager MemberManager
@{
    Layout = "Main.cshtml";
    var id = Model.Id;
    var team = Umbraco.Content(9136);
    var rosterMembers = team.Children().Where(x => x.ContentType.Alias == "roster").ToList();
    var players = rosterMembers.Where(x => !x.Value<bool>("isBenchOfficial")).ToList();
    var benchOfficials = rosterMembers.Where(x => x.Value<bool>("isBenchOfficial")).ToList();
    var heroImageObj = Model.Value<IPublishedContent>("heroImage");
    var heroImage = heroImageObj != null ? heroImageObj.Url() : "";

    var eventYear = DateTime.UtcNow.Year.ToString();

    var rootContent = Umbraco.ContentAtRoot().ToList();
    var tournaments = rootContent
        .FirstOrDefault(x => x.Name == "Home")!.Children()?
        .FirstOrDefault(x => x.Name == "Tournaments")!.Children().ToList();

    var cups = tournaments
        .FirstOrDefault(x => x.Name == "European Cups")
        .Children()
        .Select(x => x.Children.FirstOrDefault(x => x.Name == eventYear))
        .ToList();

    var championships = tournaments
        .FirstOrDefault(x => x.Name == "European Championships")
        .Children()
        .Select(x => x.Children.FirstOrDefault(x => x.Name == eventYear))
        .ToList();

    var allEvents = cups.Where(x => x != null).ToList().Concat(championships.Where(x => x != null).ToList()).ToList().Select(x => new
    {
        EventName = x.Parent.Name,
        Id = x.Id
    });

    string[] priorityCountries = { "United Kingdom", "Germany", "Switzerland", "Austria", "Denmark", "Ukraine" };

    // Get all countries and ISO codes
    var countries = CultureInfo.GetCultures(CultureTypes.SpecificCultures)
        .Select(c => new RegionInfo(c.Name))
        .Distinct()
        .Select(x => new
        {
            Country = x.EnglishName,
            ISO3 = x.ThreeLetterISORegionName
        })
        .Where(x => !string.IsNullOrEmpty(x.ISO3))
        .OrderBy(x => Array.IndexOf(priorityCountries, x.Country) == -1 ? int.MaxValue : Array.IndexOf(priorityCountries.OrderBy(x => x).ToArray(), x.Country))
        .ThenBy(x => x.Country);

    // Check if the user is logged in
    var isLoggedIn = User.Identity.IsAuthenticated;
    MemberIdentityUser user = null;

    if (isLoggedIn)
    {
        // Retrieve user details
        user = await MemberManager.GetCurrentMemberAsync();
    }

    Guid.TryParse(Context.Request.Query["team"].ToString(), out var teamInformation);
    if (teamInformation == Guid.Empty)
    {
        // build itc information from team information for event
    }
}

<div class="jumbotron jumbotron-fluid hero hero-large" style="background-image: url('@heroImage')">
    <div class="overlay"></div>
    <div class="inner">
        <div class="container custom-container">
            <h1 class="display-4">@Model.Value("heroTitle")</h1>
            <p class="lead">@Model.Value("heroSubtitle")</p>
        </div>
    </div>
</div>

<div class="container custom-container mt-5 mb-5">
    <div class="row">

        <div class="col-md-3">
            <!-- Tabs nav -->
            <div class="nav flex-column nav-pills nav-pills-custom" id="v-pills-tab" role="tablist" aria-orientation="vertical">

                <span class="nav-link mb-3 p-3 shadow" id="v-pills-players-tab">
                    <select id="eventSelect" class="form-control">
                        @{
                            <option value="">Select Event for @DateTime.Now.Year.ToString()</option>

                            foreach (var iishfEvent in allEvents)
                            {
                                <option value="@iishfEvent.Id">@iishfEvent.EventName</option>
                            }
                        }
                    </select>

                    <div id="eventInformation"></div>
                </span>
                <a class="nav-link mb-3 p-3 shadow active" id="v-pills-team-tab" data-bs-toggle="pill" href="#v-pills-team" role="tab" aria-controls="v-players-team" aria-selected="true">
                    <span class="font-weight-bold small text-uppercase">Team Information</span>
                </a>
                <a class="nav-link mb-3 p-3 shadow" id="v-pills-players-tab" data-bs-toggle="pill" href="#v-pills-players" role="tab" aria-controls="v-players-players" aria-selected="true">
                    <span class="font-weight-bold small text-uppercase">Players</span>
                </a>
                <a class="nav-link mb-3 p-3 shadow" id="v-pills-bench-tab" data-bs-toggle="pill" href="#v-pills-bench" role="tab" aria-controls="v-bench-bench" aria-selected="true">
                    <span class="font-weight-bold small text-uppercase">Bench Officials</span>
                </a>
                <a class="nav-link mb-3 p-3 shadow" id="v-pills-submit-tab" data-bs-toggle="pill" href="#v-pills-submit" role="tab" aria-controls="v-submit-submit" aria-selected="true">
                    <span class="font-weight-bold small text-uppercase">Validate and Submit</span>
                </a>
            </div>

        </div>
        <div class="col-md-9">
            <!-- Tabs content -->
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade shadow rounded bg-white show active p-5" id="v-pills-team" role="tabpanel" aria-labelledby="v-pills-team-tab">
                    <div class="row form-group">
                        <label for="teamName" class="col-12 col-md-4 col-form-label">Team Name:</label>
                        <div class="col-12 col-md-8">
                            <input type="text" class="form-control" placeholder="Team Name" id="teamName" />
                        </div>
                    </div>
                    <div class="row form-group">
                        <label for="teamSignatory" class="col-12 col-md-4 col-form-label">Team Signatory:</label>
                        <div class="col-12 col-md-8">
                            <input type="text" class="form-control" placeholder="Team Signatory" id="teamSignatory" />
                        </div>
                    </div>
                    <div class="row form-group">
                        <label for="issuingCountry" class="col-12 col-md-4 col-form-label">Issuing Country:</label>
                        <div class="col-12 col-md-8">
                            <select class="form-control" id="issuingCountry" name="issuingCountry">
                                <option value="">Nationality</option>
                                @{
                                    bool addedSeparator = false; // Flag to check if separator has been added
                                                                 // This will get the index of last priority country in the sorted list
                                    var lastPriorityCountryIndex = countries.ToList().FindLastIndex(c => priorityCountries.Contains(c.Country));

                                    foreach (var country in countries)
                                    {
                                        <option value="@country.Country">@country.Country</option>
                                        if (countries.ToList().IndexOf(country) == lastPriorityCountryIndex && !addedSeparator)
                                        {
                                            // Add the separator
                                            <option disabled>──────────</option>
                                            addedSeparator = true; // Ensure the separator is only added once
                                        }
                                    }
                                }

                            </select>
                        </div>
                    </div>
                    <div class="row form-group">
                        <label for="colourOne" class="col-12 col-md-4 col-form-label">First Jersey Colour:</label>
                        <div class="col-12 col-md-4">
                            <div class="input-group mb-3">
                                <div id="colorPicker" class="input-group-prepend color-picker-container"></div>
                                <input type="text" class="form-control" placeholder="Team colour" id="colourOne" aria-label="Team colour in hex" aria-describedby="colorPickerAddon">
                            </div>
                        </div>
                    </div>
                    <div class="row form-group">
                        <label for="jerseyTwoColour" class="col-12 col-sm-4 col-md-4 col-form-label">Second Jersey Colour:</label>
                        <div class="col-12 col-md-4">
                            <div class="input-group mb-3">
                                <div id="colorPicker2" class="input-group-prepend color-picker-container"></div>
                                <input type="text" class="form-control" placeholder="Team colour" id="colourTwo" aria-label="Team colour in hex" aria-describedby="colorPickerAddon">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade shadow rounded bg-white show p-5" id="v-pills-players" role="tabpanel" aria-labelledby="v-pills-players-tab">
                    <div class="table-responsive">
                        <table id="data-table" class="table table-hover mb-5 tablesaw" data-tablesaw-mode="stack">
                            <thead>
                                <tr>
                                    <th style="width: 150px">License</th>
                                    <th>Role</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th style="width: 50px">Jersey Number</th>
                                    <th>Date of Birth</th>
                                    <th>Nationality</th>
                                    <th>Gender</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="formRows">
                                @for (int i = 0; i < players.Count(); i++)
                                {
                                    <tr data-id="@players[i].Id">
                                        <td>
                                            <span>@players[i].Value("licenseNumber")</span>
                                        </td>
                                        <td>

                                            <span>@players[i].Value("role")</span>
                                        </td>
                                        <td>

                                            <span>@players[i].Value("firstName")</span>
                                        </td>
                                        <td>

                                            <span>@players[i].Value("lastName")</span>
                                        </td>
                                        <td>
                                            <span>@players[i].Value("jerseyNumber")</span>
                                        </td>
                                        <td>
                                            @{
                                                var dob = players[i].Value<DateTime>("dateOfBirth").ToString("dd.MM.yyyy");
                                            }
                                            <span>@dob</span>
                                        </td>
                                        <td>
                                            <span>@players[i].Value("nationality")</span>
                                        </td>
                                        <td>

                                            <span>@players[i].Value("gender")</span>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger delete-btn" onclick="event.stopPropagation(); deleteRow(this);">
                                                <i class="fas fa-trash"></i>
                                            </button>

                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <button id="addRowButton" type="button">Add Row</button>
                    <button type="submit" onclick="validateForms()">Validate</button>

                </div>

                <div class="tab-pane fade shadow rounded bg-white show p-5" id="v-pills-bench" role="tabpanel" aria-labelledby="v-pills-bench-tab">
                    <table id="benchOfficials" class="table table-hover mb-5 tablesaw" data-tablesaw-mode="stack">
                        <thead>
                            <tr>
                                <th style="width: 150px">License</th>
                                <th>Role</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Date of Birth</th>
                                <th>Nationality</th>
                                <th>Gender</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="formRowsBench">
                            @for (int i = 0; i < benchOfficials.Count(); i++)
                            {
                                <tr data-id="@benchOfficials[i].Id">
                                    <td>
                                        <span>@benchOfficials[i].Value("licenseNumber")</span>
                                    </td>
                                    <td>
                                        <span>@benchOfficials[i].Value("role")</span>

                                    </td>
                                    <td>

                                        <span>@players[i].Value("firstName")</span>
                                    </td>
                                    <td>

                                        <span>@players[i].Value("lastName")</span>
                                    </td>
                                    <td>
                                        @{
                                            var dob = benchOfficials[i].Value<DateTime>("dateOfBirth").ToString("dd.MM.yyyy");
                                        }
                                        <span>@dob</span>
                                    </td>
                                    <td>
                                        <span>@benchOfficials[i].Value("nationality")</span>
                                    </td>
                                    <td>
                                        <span>@benchOfficials[i].Value("gender")</span>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger" onclick="deleteRow(this)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div id="addBenchOfficialButtonErrors" class="alert alert-danger" role="alert">
                        <h3>Cannot add more than 8 bench officials</h3>
                    </div>
                    <button id="addBenchOfficialButton" type="button">Add Row</button>

                </div>
                <div class="tab-pane fade shadow rounded bg-white show p-5" id="v-pills-submit" role="tabpanel" aria-labelledby="v-pills-submit-tab">
                    <button class="btn btn-warning" type="submit" onclick="validateForms()">Validate</button>
                    <button class="btn btn-light" onclick="saveAsDraft()">Save Draft</button>
                    <button class="btn btn-secondary" onclick="submit()">Submit</button>
                    <div id="submissionErrors" class="alert alert-danger mb-3" role="alert">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*Change name to first name and last name*@
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Data</h5>
                <button type="button" class="close close-edit" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- The form inside the modal -->
                <form id="edit-form">
                    <div class="form-group">
                        <label for="license">License:</label>
                        <input type="text" class="form-control" id="license" name="license">
                    </div>
                    <div class="form-group">
                        <label for="role">Role:</label>
                        <select class="form-control" id="role" name="role">
                            <option value="">Select Role</option>
                            <option value="Captain">Captain</option>
                            <option value="Assistant Captain">Assistant Captain</option>
                            <option value="Netminder">Netminder</option>
                            <!-- Add other role options here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" class="form-control" id="firstName" name="firstName">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" class="form-control" id="lastName" name="lastName">
                    </div>
                    <div id="jerseyNumberFormGroup" class="form-group">
                        <label for="jerseyNumber">Jersey Number:</label>
                        <input type="text" class="form-control" id="jerseyNumber" name="jerseyNumber">
                    </div>
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth:</label>
                        <input type="text" class="form-control" id="dateOfBirth" name="dateOfBirth">
                    </div>
                    <div class="form-group">
                        <label for="nationality">Nationality:</label>
                        <select class="form-control" id="nationality" name="nationality">
                            <option value="">Nationality</option>
                            @foreach (var country in countries)
                            {
                                <option value="@country.Country">@country.Country</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender:</label>
                        <!-- Label and select for Gender -->
                        <select class="form-control" id="gender" name="gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <!-- Add other gender options here -->
                        </select>
                    </div>

                    <!-- Add more input fields as necessary -->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-edit" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveChanges">Update table</button>
            </div>
        </div>
    </div>
</div>

<script>

    var countries = @Html.Raw(Json.Serialize(@countries));
    $("#submissionErrors").hide();

    var deletedLicenseNumbers = [];
    var selectedRoles = [];
    var allErrors = [];
    var licenseNumbers = [];
    var benchOfficialLicenseNumbers = []
    var licenseNumbersEncountered = [];
    var jerseyNumbersEncountered = [];
    var currentMode = 'add';
    var currentRow = null;
    var currentMode = 'player'; // Default mode
    var pickerOneHexVal = "";
    var pickerTwoHexVal = "";

    function deleteRow(button) {
        // Find the row containing the clicked button
        var row = $(button).closest('tr');

        // Extract the license number from the span
        var licenseNumber = row.find("td:eq(0) span span").text().trim();

        // Add the license number to the array (if it's not empty)
        if (licenseNumber) {
            deletedLicenseNumbers.push(licenseNumber);
        }
        var titleEvent = $('#shortCode').val()
        var rosterId = row.data('id')
        var eventSelectValue = $("#eventSelect").val();
        var isChampionship = eventSelectValue.toLowerCase().includes("championship");

        var startDateText = $("#startDate").text();
        var eventYear = ''

        if (startDateText) {
            var parts = startDateText.split('.');

            if (parts.length >= 3) {
                eventYear = parts[2];
            } else {
                console.log("The date format is not as expected.");
            }
        } else {
            console.log("No text found for #startDate.");
        }

        var teamName = $("#teamName").val()

        var url = `/api/events/itc/team/titel-event/${titleEvent}/championship/${isChampionship}/year/${eventYear}/team/${teamName}/roster-member/${rosterId}`
        var encodedUrl = encodeURI(url);
        $.ajax({
            url: encodedUrl,
            type: 'DELETE',
            success: function (data) {
                // Remove the row from the table
                row.remove();
            },
            error: function (xhr, status, error) {
                console.error("Error: " + error);
                // Show alert that something went wrong
            }
        });
    }

    function validateRow(licenseNumber, jerseyNumber, firstName, lastName, role, dateOfBirth, nationality, gender, rowIndex) {

        var errors = [];
        if (!licenseNumber || isNaN(parseInt(licenseNumber))) {
            errors.push('Invalid license number at row ' + (rowIndex + 1));
        }
        if (!jerseyNumber || isNaN(parseInt(jerseyNumber))) {
            errors.push('Invalid jersey number at row ' + (rowIndex + 1));
        }

        if (!firstName || firstName === "") {
            errors.push('Player name first is required');
        }
        if (!lastName || lastName === "") {
            errors.push('Player last name is required');
        }

        if (!dateOfBirth || dateOfBirth === "" || dateOfBirth === "01.01.0001") {
            errors.push('Date of birth is requried');
        }

        if (!nationality || nationality === "") {
            errors.push('Nationality is requried');
        }

        if (!role || role === "") {
            errors.push('Roster member role is requried');
        }

        if (!gender || gender === "") {
            errors.push('Roster member gender is requried');
        }
        var isFemale = gender !== "" && gender === "Female";
        var ageGroup = $("#ageGroup").text();
        if (dateOfBirth !== "01.01.0001" && !validateAge(dateOfBirth, ageGroup, isFemale)) {
            errors.push('Player is outside of the designated age range for this event');
        }

        return errors;
    }

    function validateBenchRow(licenseNumber, firstName, lastName, role, dateOfBirth, nationality, gender, rowIndex) {

        var errors = [];
        if (!licenseNumber || isNaN(parseInt(licenseNumber))) {
            errors.push('Invalid license number at row ' + (rowIndex + 1));
        }

        if (!firstName || firstName === "") {
            errors.push('Official name first is required');
        }

        if (!lastName || lastName === "") {
            errors.push('Official last name is required');
        }

        if (!dateOfBirth || dateOfBirth === "" || dateOfBirth === "01.01.0001") {
            errors.push('Date of birth is requried');
        }

        if (!nationality || nationality === "") {
            errors.push('Nationality is requried');
        }

        if (!role || role === "") {
            errors.push('Roster member role is requried');
        }

        if (!gender || gender === "") {
            errors.push('Roster member gender is requried');
        }

        return errors;
    }

    function validateForm() {
        var isValid = true;
        var licenseNumbers = [];
        var jerseyNumbers = [];
        var roles = [];

        // Clear any previous error indicators
        $('#formRows tr').removeClass('table-danger');
        $('#submissionErrors').empty().hide();
        // Collect all license and jersey numbers
        $('#formRows tr').each(function (index) {
            var currentRow = $(this);
            var licenseNumber = currentRow.find("td:eq(0) span span").text().trim();
            var jerseyNumber = currentRow.find("td:eq(4) span span").text().trim();
            var role = currentRow.find("td:eq(1) span span").text().trim();
            var playerName = currentRow.find("td:eq(2) span span").text().trim() + ' ' + currentRow.find("td:eq(3) span span").text().trim();


            // Add numbers to arrays for duplicate checking
            if (licenseNumber) {
                licenseNumbers.push({ number: licenseNumber, row: index + 1 });
            }
            if (jerseyNumber) {
                jerseyNumbers.push({ number: jerseyNumber, row: index + 1 });
            }
            if (role) {
                roles.push({ role: role, row: index + 1 });
            }

        });

        var sanction = $("#sanction").text();
        var classification = sanction.charAt(0).toUpperCase(); // Get the first character and convert to uppercase
        var isTitleEvent = classification === "A";

        // Check for duplicates in license and jersey numbers
        var duplicateLicenseNumbers = findDuplicates(licenseNumbers);
        var duplicateJerseyNumbers = findDuplicates(jerseyNumbers);

        var roleArray = roles.map(item => item.role);

        var netminderCount = roleArray.filter(x => x === "Netminder");
        var captainCount = roleArray.filter(x => x === "Captain");
        var assitantCaptainCount = roleArray.filter(x => x === "Assistant Captain");

        // create title event check here too
        if (netminderCount.length < 2 && isTitleEvent) {
            allErrors.push({
                name: "Minimum netminder count not met",
                errors: "For a IISHF Title Event each competing team must have a minimum of two netminders. Please refer to IISHF Regulations 18.18 "
            });
        }

        if (!captainCount || captainCount.length > 1) {
            allErrors.push({
                name: "Too many players are listed as Captain",
                errors: "A team can only have one named captain. You may change your captain per game at an event, however, your ITC may only have one listed person as captain"
            });
        }

        if (!assitantCaptainCount || assitantCaptainCount.length > 1) {
            allErrors.push({
                name: "Too many players are listed as Assitant Captain",
                errors: "A team can only have one named Assistant Captain. You may change your captain per game at an event, however, your ITC may only have one listed person as captain"
            });
        }

        if (!captainCount || captainCount.length === 0) {
            allErrors.push({
                name: "Missing Captain",
                errors: "A team must have one named captain"
            });
        }

        if (!assitantCaptainCount || assitantCaptainCount.length === 0) {
            allErrors.push({
                name: "Missing Assitant Captain",
                errors: "A team must have one named Assistant Captain."
            });
        }

        // Validate each row
        $('#formRows tr').each(function (index) {
            var currentRow = $(this);
            var rowErrors = [];

            var licenseNumber = currentRow.find("td:eq(0) span span").text().trim();
            var role = currentRow.find("td:eq(1) span span").text().trim();
            var firstName = currentRow.find("td:eq(2) span span").text().trim();
            var lastName = currentRow.find("td:eq(3) span span").text().trim();
            var jerseyNumber = currentRow.find("td:eq(4) span span").text().trim();
            var dateOfBirth = currentRow.find("td:eq(5) span span").text().trim();
            var nationality = currentRow.find("td:eq(6) span span").text().trim();
            var gender = currentRow.find("td:eq(7) span span").text().trim();

            var rowErrors = validateRow(licenseNumber, jerseyNumber, firstName, lastName, role, dateOfBirth, nationality, gender, index);

            // Check if license or jersey number is in duplicate arrays
            if (duplicateLicenseNumbers.has(licenseNumber)) {
                rowErrors.push('Duplicate license number: ' + licenseNumber);
            }
            if (duplicateJerseyNumbers.has(jerseyNumber)) {
                rowErrors.push('Duplicate jersey number: ' + jerseyNumber);
            }

            // Highlight the row if there are errors
            if (rowErrors.length > 0) {
                isValid = false;
                currentRow.addClass('table-danger');
                allErrors.push({
                    name: firstName + ' ' + lastName,
                    errors: rowErrors
                });
            }

            console.log(allErrors)
        });

        return isValid;
    }

    function validateAge(dateOfBirth, ageGroup, isFemale) {
        // Parse the date of birth to a Date object
        var parts = dateOfBirth.split('.');
        if (parts.length !== 3) {
            return false; // Invalid date format
        }

        var day = parseInt(parts[0], 10);
        var month = parseInt(parts[1], 10) - 1; // Month is zero-based
        var year = parseInt(parts[2], 10);

        var dobDate = new Date(year, month, day);

        // Check if the date is a valid date
        if (isNaN(dobDate.getTime())) {
            return false; // Invalid date
        }

        // Calculate the age based on the date of birth
        var currentYear = new Date().getFullYear();
        var birthYear = dobDate.getFullYear();
        var age = currentYear - birthYear;

        // Define age validation rules based on age group and gender
        // Female check first
        // Male check second
        // Female players can be one year older in teh age group.

        var sanction = $("#sanction").text()
        var classification = sanction.substring(1)
        var isTitleEvent = classification === "A" || classification === "a";

        var eventSelectValue = $("#eventSelect").val();
        var isChampionshipEvent = eventSelectValue.toLowerCase().includes("championship");

        // Define the additional age adjustment based on gender and age group for title events
        var additionalAgeAdjustment = 0; // Default value

        if (isTitleEvent && !isChampionshipEvent) {
            if (!isFemale) {
                // Male players can be one year older in U19, U16, U13, and U10 age groups
                if (ageGroup === 'U19' || ageGroup === 'U16' || ageGroup === 'U13' || ageGroup === 'U10') {
                    additionalAgeAdjustment = 1;
                }
            } else {
                // Female players can be two years older in U19, U16, U13, and U10 age groups
                if (ageGroup === 'U19' || ageGroup === 'U16' || ageGroup === 'U13' || ageGroup === 'U10') {
                    additionalAgeAdjustment = 2;
                }
            }
        }

        // Adjust the age based on the additional age adjustment
        age += additionalAgeAdjustment;

        switch (ageGroup) {
            case 'U19':
                if ((isFemale && age >= 13 && age <= 19) || (!isFemale && age >= 13 && age <= 18)) {
                    return true; // Valid age
                }
                break;
            case 'U16':
                if ((isFemale && age >= 10 && age <= 16) || (!isFemale && age >= 10 && age <= 15)) {
                    return true; // Valid age
                }
                break;
            case 'U13':
                if ((isFemale && age >= 10 && age <= 13) || (!isFemale && age >= 10 && age <= 12)) {
                    return true; // Valid age
                }
                break;
            case 'U10':
                if (age <= 9) {
                    return true; // Valid age
                }
                break;
            case 'Senior':
                if (age >= 19) {
                    return true; // Valid age
                }
                break;
            case 'Senior Women':
                if (age >= 16) {
                    return true; // Valid age
                }
                break;
            case 'Masters':
                if (age >= 45) {
                    return true; // Valid age
                }
                break;
            case 'Women':
                if (age >= 35) {
                    return true; // Valid age
                }
                break;
            default:
                return false; // Invalid age group
        }

        return false; // Age does not meet the specified age group rules
    }

    function validateBenchForm() {
        var isValid = true;
        var licenseNumbers = [];
        var jerseyNumbers = [];

        // Clear any previous error indicators
        $('#formRowsBench tr').removeClass('table-danger');
        $('#submissionErrors').empty().hide();
        // Collect all license and jersey numbers
        $('#formRowsBench tr').each(function (index) {
            var currentRow = $(this);
            var licenseNumber = currentRow.find("td:eq(0) span span").text().trim();
            var jerseyNumber = currentRow.find("td:eq(3) span span").text().trim();

            // Add numbers to arrays for duplicate checking
            if (licenseNumber) {
                licenseNumbers.push({ number: licenseNumber, row: index + 1 });
            }
            if (jerseyNumber) {
                jerseyNumbers.push({ number: jerseyNumber, row: index + 1 });
            }
        });

        // Check for duplicates in license and jersey numbers
        var duplicateLicenseNumbers = findDuplicates(licenseNumbers);
        var duplicateJerseyNumbers = findDuplicates(jerseyNumbers);

        // Validate each row
        $('#formRowsBench tr').each(function (index) {
            var currentRow = $(this);
            var rowErrors = [];

            var licenseNumber = currentRow.find("td:eq(0) span span").text().trim();
            var role = currentRow.find("td:eq(1) span span").text().trim();
            var firstName = currentRow.find("td:eq(2) span span").text().trim();
            var lastName = currentRow.find("td:eq(3) span span").text().trim();
            var dateOfBirth = currentRow.find("td:eq(4) span span").text().trim();
            var nationality = currentRow.find("td:eq(5) span span").text().trim();
            var gender = currentRow.find("td:eq(6) span span").text().trim();

            var rowErrors = validateBenchRow(licenseNumber, firstName, lastName, role, dateOfBirth, nationality, gender, index);

            // Check if license or jersey number is in duplicate arrays
            if (duplicateLicenseNumbers.has(licenseNumber)) {
                rowErrors.push('Duplicate license number: ' + licenseNumber);
            }

            // Highlight the row if there are errors
            if (rowErrors.length > 0) {
                isValid = false;
                currentRow.addClass('table-danger');
                allErrors.push({
                    name: firstName + ' ' + lastName,
                    errors: rowErrors
                });
            }

            console.log(allErrors)
        });

        return isValid;
    }

    function findDuplicates(numbers) {
        var duplicates = new Set();
        var seen = new Map();

        numbers.forEach(item => {
            if (seen.has(item.number)) {
                duplicates.add(item.number);
            } else {
                seen.set(item.number, item.row);
            }
        });

        return duplicates;
    }

    function displayValidationErrors(errors) {
        var errorContainer = $('#submissionErrors');
        errorContainer.empty();

        if (errors) {
            errorContainer.show();
            var errorList = $('<ul></ul>');

            if (Array.isArray(errors)) {
                // Handle errors as an array of objects
                for (var i = 0; i < errors.length; i++) {
                    if (errors[i]) {
                        if (Array.isArray(errors[i].errors)) {

                            var errorText = ""
                            if(errors[i].name === ""){
                                errors[i].errors.join(', ');

                            }else{
                                errorText = errors[i].name + ': ' + errors[i].errors.join(', ');
                            }

                            errorList.append($('<li></li>').text(errorText));
                        } else if (typeof errors[i].errors === 'string') {
                            errorList.append($('<li></li>').text(errors[i].name + ': ' + errors[i].errors));
                        }
                    }
                }
            } else if (typeof errors === 'string') {
                // Handle errors as a single string
                errorList.append($('<li></li>').text(errors));
            }

            errorContainer.append(errorList);
        } else {
            errorContainer.hide();
        }
    }

    function validateForms() {
        allErrors = [];
        licenseNumbers = [];
        benchOfficialLicenseNumbers = []
        playersAndOfficials = []

        var teamName = $('#teamName').val(); // Gets the value from the Team Name input field
        var teamSignatory = $('#teamSignatory').val(); // Gets the value from the Team Signatory input field
        var issuingCountry = $('#issuingCountry').val(); // Gets the selected value from the Issuing Country dropdown

        if (teamName === "") {
            allErrors.push({
                name: "Team name not supplied",
                errors: 'A team name must be provided'
            });
        }

        if (teamSignatory === "") {
            allErrors.push({
                name: "Team signatory name not supplied",
                errors: 'A team name must be provided'
            });
        }

        if (teamSignatory === teamName) {
            allErrors.push({
                name: "Team signatory cannot be a team name",
                errors: 'Team signatory is the named person responsible for the team whilst at the event. Team signatory should also be the same person submitting the ITC.'
            });
        }

        if (issuingCountry === "") {
            allErrors.push({
                name: "Issuing Country not supplied",
                errors: 'Please provide the issuing country details. This is the country of the team that this document is being issued on behalf of. '
            });
        }

        validateForm();
        validateBenchForm()
        // Call the function to check for duplicate license numbers
        ////checkDuplicateLicenseNumbers()
        checkDuplicatePlayerNameAndLicenseNumber()
        displayValidationErrors(allErrors);
    }

    function saveAsDraft() {
        var json = generateJson();
        console.log(JSON.stringify(json));

        $.ajax({
            type: "PUT",
            url: "/api/events/itc",
            data: JSON.stringify(json),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                console.log("Sending results to update row ids");
                updateRowIds(result);
            },
            error: function (result) {
                console.log(result);
            }
        });
    }

    function updateRowIds(updatedRoster) {
        console.log("updating row ids")
        updatedRoster.ItcRosterMembers.forEach(function (member) {
            if (member.Id !== 0) {
                // Construct the jQuery selector to find the row with matching license number and last name
                $("#data-table tbody tr").each(function () {
                    var license = $(this).find('td:nth-child(1) span span').text().trim();
                    var lastName = $(this).find('td:nth-child(4) span span').text().trim();
                    

                    if (license === member.License && lastName === member.LastName) {
                        $(this).attr('data-id', member.Id);
                    }
                });
            }
        });
    }


    function generateJson() {

        // Retrieve the value of the element with ID 'startDate'
        var startDate = $("#startDate").text();
        var year = "";
        // Check if startDate is not undefined or null
        if (startDate) {
            // Split the value by the dot
            var parts = startDate.split('.');

            // Check if the array has at least three parts (to avoid errors)
            if (parts.length >= 3) {
                year = parts[2]; // This will be the third part of the split string
            } else {
                console.log("The date format is not as expected.");
            }
        } else {
            console.log("No value found for #startDate.");
        }

        var formData = {
            "EventYear": year, // Assuming you have an input for EventYear
            "TitleEvent": $('#shortCode').val(), // Assuming you have an input for TitleEvent
            "isChampionship": document.getElementById('isChampionship').checked, // Assuming you have a checkbox for IsChampionship
            "ItcRosterMembers": [],
            "TeamName": $('#teamName').val() // Assuming you have an input for TeamName
        };
     
        var processRow = function (currentRow, isBench) {
            var $currentRow = $(currentRow); // Convert to jQuery object
            var rosterId = $currentRow.data('id');
            var license = currentRow.querySelector("td:nth-child(1) span span").textContent.trim();
            var role = currentRow.querySelector("td:nth-child(2) span span").textContent.trim();
            var firstName = currentRow.querySelector("td:nth-child(3) span span").textContent.trim();
            var lastName = currentRow.querySelector("td:nth-child(4) span span").textContent.trim();
            var jerseyNumber = currentRow.querySelector("td:nth-child(5) span span").textContent.trim();
            var dateOfBirth = currentRow.querySelector("td:nth-child(6) span span").textContent.trim();
            var nationality = currentRow.querySelector("td:nth-child(7) span span").textContent.trim();
            var gender = currentRow.querySelector("td:nth-child(8) span span").textContent.trim();

            var dateOfBirth = currentRow.querySelector("td:nth-child(6) span span").textContent.trim();

            // Split the date into [day, month, year]
            var parts = dateOfBirth.split(".");

            // Rearrange the parts into yyyy-mm-dd format
            // Note: parts index starts from 0, so parts[0] is day, parts[1] is month, parts[2] is year
            var formattedDate = parts[2] + "-" + parts[1] + "-" + parts[0];
            debugger
            if (license || playerName) {
                formData.ItcRosterMembers.push({
                    "Id": rosterId,
                    "License": license,
                    "firstName": firstName,
                    "lastName": lastName,
                    "JerseyNumber": jerseyNumber,
                    "Role": role,
                    "IsBenchOfficial": isBench,
                    "DateOfBirth": formattedDate,
                    "Nationality": nationality,
                    "Gender": gender
                });
            }
        };

        document.querySelectorAll('#formRows tr').forEach(function (row) {
            processRow(row, false);
        });

        ////document.querySelectorAll('#formRowsBench tr').forEach(function (row) {
        ////    processRow(row, true);
        ////});

        return formData;
    }

    function clearModalFields() {
        $('#edit-form').find('input[type="text"], select').val('');
    }

    function populateModalFromRow(currentRow) {
        var license = currentRow.find("td:eq(0) .tablesaw-cell-content span").text().trim();
        var role = currentRow.find("td:eq(1) .tablesaw-cell-content span").text().trim();
        var firstName = currentRow.find("td:eq(2) .tablesaw-cell-content span").text().trim();
        var lastName = currentRow.find("td:eq(3) .tablesaw-cell-content span").text().trim();
        var jerseyNumber = currentRow.find("td:eq(4) .tablesaw-cell-content span").text().trim();
        var dateOfBirth = currentRow.find("td:eq(5) .tablesaw-cell-content span").text().trim();
        var nationality = currentRow.find("td:eq(6) .tablesaw-cell-content span").text().trim();
        var gender = currentRow.find("td:eq(7) .tablesaw-cell-content span").text().trim();

        $('#edit-form #license').val(license);
        $('#edit-form #role').val(role);
        $('#edit-form #firstName').val(firstName);
        $('#edit-form #lastName').val(lastName);
        $('#edit-form #jerseyNumber').val(jerseyNumber);
        $('#edit-form #dateOfBirth').val(dateOfBirth);
        $('#edit-form #nationality').val(nationality);
        $('#edit-form #gender').val(gender);
    }

    function updateRowFromModal(row) {
        row.find("td:eq(0) .tablesaw-cell-content span").text($('#edit-form #license').val());
        row.find("td:eq(1) .tablesaw-cell-content span").text($('#edit-form #role').val());
        row.find("td:eq(2) .tablesaw-cell-content span").text($('#edit-form #firstName').val());
        row.find("td:eq(3) .tablesaw-cell-content span").text($('#edit-form #lastName').val());
        row.find("td:eq(4) .tablesaw-cell-content span").text($('#edit-form #jerseyNumber').val());
        row.find("td:eq(5) .tablesaw-cell-content span").text($('#edit-form #dateOfBirth').val());
        row.find("td:eq(6) .tablesaw-cell-content span").text($('#edit-form #nationality').val());
        row.find("td:eq(7) .tablesaw-cell-content span").text($('#edit-form #gender').val());
    }

    function updateBenchOfficialRowFromModal(row) {
        row.find("td:eq(0) .tablesaw-cell-content span").text($('#edit-form #license').val());
        row.find("td:eq(1) .tablesaw-cell-content span").text($('#edit-form #role').val());
        row.find("td:eq(2) .tablesaw-cell-content span").text($('#edit-form #firstName').val());
        row.find("td:eq(3) .tablesaw-cell-content span").text($('#edit-form #lastName').val());
        row.find("td:eq(4) .tablesaw-cell-content span").text($('#edit-form #dateOfBirth').val());
        row.find("td:eq(5) .tablesaw-cell-content span").text($('#edit-form #nationality').val());
        row.find("td:eq(6) .tablesaw-cell-content span").text($('#edit-form #gender').val());
    }

    function populateModalForBenchOfficial(currentRow) {
        var license = currentRow.find("td:eq(0) .tablesaw-cell-content span").text().trim();
        var role = currentRow.find("td:eq(1) .tablesaw-cell-content span").text().trim();
        var firstName = currentRow.find("td:eq(2) .tablesaw-cell-content span").text().trim();
        var lastName = currentRow.find("td:eq(3) .tablesaw-cell-content span").text().trim();
        var dateOfBirth = currentRow.find("td:eq(4) .tablesaw-cell-content span").text().trim();
        var nationality = currentRow.find("td:eq(5) .tablesaw-cell-content span").text().trim();
        var gender = currentRow.find("td:eq(6) .tablesaw-cell-content span").text().trim();

        $('#edit-form #license').val(license);
        $('#edit-form #role').val(role);
        $('#edit-form #firstName').val(firstName);
        $('#edit-form #lastName').val(lastName);
        $('#edit-form #dateOfBirth').val(dateOfBirth);
        $('#edit-form #nationality').val(nationality);
        $('#edit-form #gender').val(gender);

        // Hide the jersey number field for bench officials
        $('#edit-form #jerseyNumber').closest('.form-group').hide();
    }

    function addNewRowFromModal() {
        var newRowHtml = '<tr data-id="0">' +
            '<td><b class="tablesaw-cell-label">License</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #license').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Role</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #role').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">First Name</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #firstName').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Last Name</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #lastName').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Jersey Number</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #jerseyNumber').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Date of Birth</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #dateOfBirth').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Nationality</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #nationality').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Gender</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #gender').val() + '</span></span></td>' +
            '<td><button type="button" class="btn btn-danger delete-btn" onclick="event.stopPropagation(); deleteRow(this);"><i class="fas fa-trash"></i></button></td>' +
            '</tr>';
        $('#data-table tbody').append(newRowHtml);
    }

    function addBenchOfficialRowFromModal() {
            var newRowHtml = '<tr data-id="0">' +
            '<td><b class="tablesaw-cell-label">License</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #license').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Role</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #role').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">First Name</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #firstName').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Last Name</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #lastName').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Date of Birth</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #dateOfBirth').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Nationality</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #nationality').val() + '</span></span></td>' +
            '<td><b class="tablesaw-cell-label">Gender</b><span class="tablesaw-cell-content"><span>' + $('#edit-form #gender').val() + '</span></span></td>' +
            '<td><button type="button" class="btn btn-danger delete-btn" onclick="event.stopPropagation(); deleteRow(this);"><i class="fas fa-trash"></i></button></td>' +
            '</tr>';
        $('#benchOfficials tbody').append(newRowHtml);
    }

    function checkDuplicateLicenseNumbers() {
        var licenseNumberMap = {}; // Object to store encountered license numbers and associated player names

        // Helper function to add player name to the license number entry
        function addPlayerName(licenseNumber, playerName) {
            if (licenseNumberMap[licenseNumber]) {
                licenseNumberMap[licenseNumber].push(playerName);
            } else {
                licenseNumberMap[licenseNumber] = [playerName];
            }
        }

        // Iterate through rows in the data table
        $('#data-table tbody tr').each(function () {
            var licenseNumber = $(this).find("td:eq(0) span span").text().trim();
            var playerName = $(this).find("td:eq(2) span span").text().trim();

            if (licenseNumber) {
                addPlayerName(licenseNumber, playerName);
            }
        });

        // Iterate through rows in the bench officials table
        $('#benchOfficials tbody tr').each(function () {
            var licenseNumber = $(this).find("td:eq(0) span span").text().trim();
            var playerName = $(this).find("td:eq(2) span span").text().trim();

            if (licenseNumber) {
                addPlayerName(licenseNumber, playerName);
            }
        });

        // Now, licenseNumberMap contains license numbers as keys and player names as values
        // You can check for duplicate license numbers and associated player names here
        for (var licenseNumber in licenseNumberMap) {
            if (licenseNumberMap[licenseNumber].length > 1) {
                allErrors.push({
                    name: licenseNumberMap[licenseNumber].join(', '),
                    errors: 'ITC listed Names with duplicate License Number in both Player and Bench Official tables with license number: ' + licenseNumber + '. Please refer to IISHF Regulations 20.13'
                });

            }
        }
    }

    function checkDuplicatePlayerNameAndLicenseNumber() {
        var playerNameAndLicense = new Set();

        // Iterate through rows in the data table
        $('#data-table tbody tr').each(function () {
            $(this).removeClass('table-danger');
            var playerName = $(this).find("td:eq(2) span span").text().trim() + ' ' + $(this).find("td:eq(3) span span").text().trim();
            var licenseNumber = $(this).find("td:eq(0) span span").text().trim();
            var combined = playerName + licenseNumber;

            if (playerName && licenseNumber) {
                if (playerNameAndLicense.has(combined)) {
                    $(this).addClass('table-danger');

                    allErrors.push({
                        name: playerName,
                        errors: 'A roster member cannot be listed as both a player and a bench official: ' + playerName + ' (' + licenseNumber + ')'
                    });
                } else {
                    playerNameAndLicense.add(combined);
                }
            }
        });

        // Iterate through rows in the bench officials table
        $('#benchOfficials tbody tr').each(function () {
            $(this).removeClass('table-danger');

            var playerName = $(this).find("td:eq(2) span span").text().trim() + ' ' + $(this).find("td:eq(3) span span").text().trim();
            var licenseNumber = $(this).find("td:eq(0) span span").text().trim();
            var combined = playerName + licenseNumber;

            if (playerName && licenseNumber) {
                if (playerNameAndLicense.has(combined)) {
                    $(this).addClass('table-danger');
                    allErrors.push({
                        name: playerName,
                        errors: 'A roster member cannot be listed as both a player and a bench official: ' + playerName + ' (' + licenseNumber + ')'
                    });
                } else {
                    playerNameAndLicense.add(combined);
                }
            }
        });
    }

    $(document).ready(function () {

        var currentRow = null;

        $('#data-table').on('click', '.btn-danger', function (event) {
            event.stopPropagation(); // Prevent click event from bubbling up to the row
            deleteRow(this); // Call your deleteRow function
        });

        $("#benchOfficials tbody").on("click", "tr", function () {
            currentMode = 'editBenchOfficial';
            currentRow = $(this);
            populateModalForBenchOfficial(currentRow);
            $('#editModal').modal('show');
        });

        $('#addRowButton').on('click', function () {
            currentMode = 'addPlayer';
            $("#jerseyNumberFormGroup").show()
            currentRow = null;
            clearModalFields();
            $('#editModal').modal('show');
        });

        $('#addBenchOfficialButton').on('click', function () {
            currentMode = 'addbenchOfficial';
            $("#jerseyNumberFormGroup").hide()
            currentRow = null;
            clearModalFields();
            $('#editModal').modal('show');
        });

        $("#data-table tbody").on("click", "tr", function () {
            currentMode = 'editPlayer';
            currentRow = $(this);
            populateModalFromRow(currentRow);
            $('#editModal').modal('show');
        });

        $("#saveChanges").on("click", function () {

            if (currentRow) {
                if (currentMode === 'editPlayer') {
                    updateRowFromModal(currentRow);
                } else if (currentMode === 'editBenchOfficial') {
                    updateBenchOfficialRowFromModal(currentRow);
                }
            } else {
                if (currentMode === 'addPlayer') {
                    // Update player row
                    addNewRowFromModal();
                } else if (currentMode === 'addbenchOfficial') {
                    // Update bench official row
                    addBenchOfficialRowFromModal();
                }
            }
            $('#editModal').modal('hide');
            clearModalFields();
        });

        function addRowToPlayer() {
            // Clear the form fields in the modal
            $('#edit-form').find('input[type="text"], select').val('');

            // Open the modal
            $('#editModal').modal('show');

            // Clear the currentRow variable since this is for adding a new row
            currentRow = null;
        }

        // Handle the save button click
        $(".close-edit").on("click", function () {
            // TODO: Add code to handle the form data, e.g., send an AJAX request
            $('#editModal').modal('hide');
        });

        // When the user clicks anywhere outside of the modal, close it
        $(window).on("click", function (event) {
            var modal = $("#edit-modal");
            if ($(event.target).is(modal)) {
                modal.hide();
            }
        });

        // Handle the form submission
        $("#edit-form").on("submit", function (event) {
            event.preventDefault();
            // TODO: Add code to handle the form data, e.g., send an AJAX request

            $("#edit-modal").hide();
        });

        var nationalityDropdown = $('select[name^="Nationality"]');
        for (var i = 0; i < countries.length; i++) {
            var option = $('<option></option>').attr('value', countries[i]).text(countries[i]);
            nationalityDropdown.append(option);
        }

        $("#addBenchOfficialButtonErrors").hide()

        $('#eventSelect').on('change', function () {
            var selectedValue = $(this).val();
            $.get('/umbraco/surface/events/GetEventInformation', { id: selectedValue }, function (data) {
                $('#eventInformation').html(data);
            });
        });

    });

    const pickr = Pickr.create({
        el: '#colorPicker',
        theme: 'classic', // or 'monolith', or 'nano'

        swatches: [
            'rgba(244, 67, 54, 1)',
            'rgba(233, 30, 99, 0.95)',
            // ... more colors
        ],

        components: {
            // Main components
            preview: true,
            opacity: true,
            hue: true,

            // Input / output Options
            interaction: {
                hex: true,
                input: true,
            }
        }
    });

    const pickr2 = Pickr.create({
        el: '#colorPicker2',
        theme: 'classic', // or 'monolith', or 'nano'

        swatches: [
            'rgba(244, 67, 54, 1)',
            'rgba(233, 30, 99, 0.95)',
            // ... more colors
        ],

        components: {
            // Main components
            preview: true,
            opacity: true,
            hue: true,

            // Input / output Options
            interaction: {
                hex: true,
                input: true,
            }
        },
        strings: {
            save: 'Apply', // Change the text for the save button to 'Apply'
            // ... other string customizations ...
        }
    });

    pickr.on('change', (color, instance) => {
        $('.pcr-button').first().css('--pcr-color', color.toRGBA().toString());
        pickerOneHexVal = color.toHEXA().toString()
        $("#colourOne").val(pickerOneHexVal)

    });

    pickr2.on('change', (color, instance) => {
        $('.pcr-button').last().css('--pcr-color', color.toRGBA().toString());
        pickerTwoHexVal = color.toHEXA().toString()
        $("#colourTwo").val(pickerTwoHexVal)
    });

    $('#colourOne').on('blur change', function () {

        var newColor = $(this).val(); // Get the new color value from the textbox
        pickr.setColor(newColor); // Update the color picker with the new color
    });

    // Event listener for the second textbox using jQuery
    $('#colourTwo').on('blur change', function () {
        var newColor = $(this).val(); // Get the new color value from the textbox
        pickr2.setColor(newColor); // Update the color picker with the new color
    });


</script>
